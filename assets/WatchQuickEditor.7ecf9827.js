import{C as e}from"./ChannelChip.f41fb5ea.js";import{bV as t,aR as s,aj as i,al as n,aW as o,aY as a,bl as r,bW as l,ar as c,an as d,aM as h,bR as u,ak as p,ao as m,ap as f,az as v}from"./vendor.f7b02bb7.js";import{b as S,k as g,n as y}from"./main.8aa73b2e.js";const _={name:"WatchQuickEditor",components:{ChannelChip:e},props:{video:{type:Object,required:!0}},data:()=>({mentions:[],search:"",searchResults:[],fake:[],hasError:!1,showSuccessAlert:!1,showErrorAlert:!1,errorMessage:"",successMessage:"",mdiAt:t,mdiContentSave:s,topics:[],newTopic:null,isSelectedAll:!1,isApplyingBulkEdit:!1,deletionSet:new Set}),computed:{role(){var e,t;return null==(t=null==(e=this.$store.state.userdata)?void 0:e.user)?void 0:t.role}},watch:{search:i((function(){this.search?S.searchChannel({type:g.VTUBER,queryText:this.search}).then((({data:e})=>{this.searchResults=e.filter((e=>!(this.video.channel.id===e.id||this.mentions.find((t=>t.id===e.id)))))})):this.searchResults=[]}),400),fake(e){e&&e.length&&e.length>0&&(this.addMention(e[0]),this.fake=null)}},mounted(){this.updateMentions()},beforeDestroy(){},methods:{updateMentions(){S.getMentions(this.video.id).then((({data:e})=>{this.mentions=e,this.searchResults=[],this.search=""})).catch((e=>{console.error(e)}))},getChannelName(e){return e[this.$store.state.settings.nameProperty]||e.name},isAddedToDeletionSet(e){return this.deletionSet.has(e)},addChannelToDeletionSet(e){this.deletionSet.add(e),this.deletionSet.size===this.mentions.length&&(this.isSelectedAll=!0),this.$forceUpdate()},removeChannelFromDeletionSet(e){this.deletionSet.delete(e),0===this.deletionSet.size&&(this.isSelectedAll=!1),this.$forceUpdate()},toggleMentionSelection(){this.isSelectedAll=!this.isSelectedAll,this.isSelectedAll?this.mentions.forEach((e=>this.deletionSet.add(e.id))):this.deletionSet.clear()},applyDeleteMentions(){this.isApplyingBulkEdit=!0;const e=Array.from(this.deletionSet);0!==e.length?S.deleteMentions(this.video.id,e,this.$store.state.userdata.jwt).then((({data:e})=>{e&&(this.deletionSet.clear(),this.isSelectedAll=!1,this.showSuccess("Successfully deleted mention"),this.updateMentions())})).catch((e=>{this.showError(e.response&&e.response.data.message||e.message||"Error occured")})).finally((()=>{this.isApplyingBulkEdit=!1,this.$forceUpdate()})):this.isApplyingBulkEdit=!1},deleteMention(e){this.removeChannelFromDeletionSet(e.id),S.deleteMentions(this.video.id,[e.id],this.$store.state.userdata.jwt).then((({data:e})=>{e&&(this.showSuccess("Successfully deleted mention"),this.updateMentions())})).catch((e=>{this.showError(e.response&&e.response.data.message||e.message||"Error occured")}))},addMention(e){this.isLoading=!0,S.addMention(this.video.id,e.id,this.$store.state.userdata.jwt).then((({data:t})=>{t&&(this.showSuccess(`Added channel: ${this.getChannelName(e)}`),this.updateMentions())})).catch((e=>{this.showError(e.response&&e.response.data.message||e.message||"Error occured")}))},showError(e){this.errorMessage=e,this.showErrorAlert=!0,setTimeout((()=>{this.showErrorAlert=!1}),4e3)},showSuccess(e){this.showSuccessAlert=!0,this.successMessage=e,setTimeout((()=>{this.showSuccessAlert=!1}),4e3)},async loadTopics(){this.topics.length>0||(this.topics=(await S.topics()).data.map((e=>{var t;return{value:e.id,text:`${e.id} (${null!=(t=e.count)?t:0})`}})))},saveTopic(){S.topicSet(this.newTopic,this.video.id,this.$store.state.userdata.jwt),this.topic=this.newTopic}}};var w=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(n,{staticClass:"watch-card rounded-0 striped"},[e.errorMessage?s(o,{attrs:{color:"error",dismissible:""},model:{value:e.showErrorAlert,callback:function(t){e.showErrorAlert=t},expression:"showErrorAlert"}},[e._v(" "+e._s(e.errorMessage)+" ")]):e._e(),e.successMessage?s(o,{attrs:{color:"success",dismissible:"",absolute:"",top:"",app:""},model:{value:e.showSuccessAlert,callback:function(t){e.showSuccessAlert=t},expression:"showSuccessAlert"}},[e._v(" "+e._s(e.successMessage)+" ")]):e._e(),s("div",{staticClass:"d-flex justify-space-between flex-wrap align-top"},["placeholder"!==e.video.type?s(a,{attrs:{cols:"auto"}},[s(r,{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on,n=t.attrs;return[s(l,e._g(e._b({attrs:{rounded:"",left:"",size:"40"}},"v-avatar",n,!1),i),[s(c,{attrs:{icon:""},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.applyDeleteMentions()}}},[e.isApplyingBulkEdit?s(h,{attrs:{size:25,indeterminate:""}}):s(d,{attrs:{size:"25",color:"grey darken-2"}},[e._v(" "+e._s(e.icons.mdiContentSaveEdit)+" ")])],1)],1)]}}],null,!1,1784265764)},[s("span",[e._v("Apply Changes")])]),s(r,{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on,n=t.attrs;return[s(l,e._g(e._b({attrs:{rounded:"",left:"",size:"40"}},"v-avatar",n,!1),i),[s(c,{attrs:{icon:""},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.toggleMentionSelection()}}},[e.isSelectedAll?s(d,{attrs:{size:"25",color:"grey darken-2"}},[e._v(" "+e._s(e.icons.mdiSelectOff)+" ")]):s(d,{attrs:{size:"25",color:"grey darken-2"}},[e._v(" "+e._s(e.icons.mdiSelectAll)+" ")])],1)],1)]}}],null,!1,26130707)},[e.isSelectedAll?s("span",[e._v("Deselect All")]):s("span",[e._v("Select All")])]),e._l(e.mentions,(function(t){return[s("ChannelChip",{key:t.id+"chip",attrs:{channel:t,size:60,"close-delay":0},scopedSlots:e._u([{key:"default",fn:function(){return[e.isAddedToDeletionSet(t.id)?s(u,{attrs:{absolute:""}},[s(c,{attrs:{icon:""},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),e.removeChannelFromDeletionSet(t.id)}}},[s(d,[e._v(e._s(e.icons.mdiDelete))])],1)],1):s(u,{attrs:{absolute:"",opacity:0}},[s(c,{attrs:{icon:""},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),e.addChannelToDeletionSet(t.id)}}})],1)]},proxy:!0}],null,!0)})]})),s(p,{staticStyle:{"min-width":"300px"},attrs:{"search-input":e.search,items:e.searchResults,"hide-no-data":"",multiple:"","hide-details":"",rules:[],"return-object":"","item-value":"id",label:"Add Mentioned Channels","no-filter":""},on:{"update:searchInput":function(t){e.search=t},"update:search-input":function(t){e.search=t}},scopedSlots:e._u([{key:"selection",fn:function(t){return[s("ChannelChip",{key:t.item.id+"chip",attrs:{channel:t.item,size:60}},[s(c,{attrs:{icon:""},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),e.deleteMention(t.item)}}},[s(d,[e._v(e._s(e.icons.mdiClose))])],1)],1)]}},{key:"item",fn:function(t){return[s(m,{staticClass:"py-1 pt-1",on:{click:function(s){return s.stopPropagation(),e.addMention(t.item)}}},[s(f,{staticClass:"text--primary"},[e._v(" "+e._s(e.getChannelName(t.item))+" ")])],1)]}}],null,!1,2736074276),model:{value:e.fake,callback:function(t){e.fake=t},expression:"fake"}})],2):e._e(),s(v,{attrs:{vertical:""}}),"stream"===e.video.type||"placeholder"===e.video.type?s(a,{attrs:{cols:"auto"}},[s(l,{attrs:{rounded:"",left:"",size:"40"}},[s(d,{attrs:{size:"25",color:"grey darken-2"}},[e._v(" "+e._s(e.icons.mdiAnimationPlay)+" ")])],1),s("span",{staticClass:"text-overline ml-3 text--disabled"},[e._v(e._s(e.$t("component.search.type.topic")))]),s(p,{attrs:{items:e.topics,inline:"","hide-details":"",label:"Topic (leave empty to unset)","append-outer-icon":e.mdiContentSave},on:{click:e.loadTopics,"click:append-outer":e.saveTopic},model:{value:e.newTopic,callback:function(t){e.newTopic=t},expression:"newTopic"}})],1):e._e()],1)],1)},k=[];w._withStripped=!0;const A={};var b=y(_,w,k,!1,C,null,null,null);function C(e){for(let t in A)this[t]=A[t]}b.options.__file="src/components/watch/WatchQuickEditor.vue";const M=function(){return b.exports}();export{M as default};