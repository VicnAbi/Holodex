var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=(t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,r=(e,t)=>{for(var s in t||(t={}))n.call(t,s)&&a(e,s,t[s]);if(i)for(var s of i(t))o.call(t,s)&&a(e,s,t[s]);return e};import{_ as l,n as c,M as u,R as m,m as d,b as g,o as h,d as p}from"./main.8aa73b2e.js";import{ay as v,bZ as y,b_ as b,b$ as f,c0 as _,c1 as k,U as P,c2 as w,c3 as S,c4 as x,c5 as E,z as $,aC as C,bD as T,c6 as O,c7 as I,ar as N,an as B,aM as M,c8 as A,aP as L,as as j,am as q}from"./vendor.f7b02bb7.js";import{Y as D,S as F}from"./SongItem.af0b257c.js";const R={name:"SongFrame",components:{Keypress:()=>l((()=>import("./index.586cbda5.js")),["assets/index.586cbda5.js","assets/main.8aa73b2e.js","assets/main.8f43dace.css","assets/vendor.f7b02bb7.js","assets/vendor.06e82a89.css"]),Youtube:D},props:{playback:{type:Object,required:!0},isBackground:{type:Boolean,default:!1}},data:()=>({timer:null,player:null}),computed:{containerClass(){return this.isBackground?"song-player-container-background":"song-player-container"}},watch:{playback:{deep:!0,handler:"nextSong"}},methods:{nextSong(e,t){console.log("Next song engaged:",t.song.video_id,"->",e.song.video_id),console.log("Next song engaged:",t.song.start,"->",e.song.start),e.playId!==t.playId&&(t.song.video_id===e.song.video_id&&t.song.start===e.song.start?(console.log("The songs are the same, but playback ID is probably different:"),this.player.loadVideoById({startSeconds:e.song.start,endSeconds:e.song.end,videoId:e.song.video_id})):t.song.start!==e.song.start&&t.song.video_id===e.song.video_id&&this.player.seekTo(e.song.start))},ready(e){this.player=e,this.setTimer()},setTimer(){this.timer&&clearInterval(this.timer),this.player&&(this.timer=setInterval((()=>{const e=this.player.getCurrentTime();this.$emit("progress",e)}),1e3))},keyPress({event:e}){if(this.player){const t=this.player;switch(e.key){case"j":t.seekTo(Math.max(t.getCurrentTime()-10,0),!0);break;case"k":1===t.getPlayerState()?t.pauseVideo():t.playVideo();break;case"l":t.seekTo(Math.min(t.getCurrentTime()+10,t.getDuration()),!0);break;case"m":t.isMuted()?t.unMute():t.mute()}}}}};var V=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:e.containerClass},[s("div",{staticClass:"song-player"},[e.playback.song.video_id?s("youtube",e._g({attrs:{"video-id":e.playback.song.video_id,"player-vars":Object.assign({},e.playback.song.start&&{start:e.playback.song.start},e.playback.song.end&&{end:e.playback.song.end},{autoplay:1,playsinline:1,controls:1,disablekb:0,fs:1,modestbranding:1,rel:0,cc_load_policy:0,iv_load_policy:3})},on:{ready:e.ready}},e.$listeners)):e._e(),s("Keypress",{on:{any:e.keyPress}})],1)])},H=[];V._withStripped=!0;const Y={};var U=c(R,V,H,!1,z,null,null,null);function z(e){for(let t in Y)this[t]=Y[t]}U.options.__file="src/components/media/SongFrame.vue";const W=function(){return U.exports}(),G={components:{SongItem:F},props:{songs:{type:Array,required:!0},currentId:{type:Number,required:!1,default:null}},methods:{shown(){this.currentId&&0!==this.currentId&&document.querySelector(".song-list .active").scrollIntoView()}}};var K=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(v,{directives:[{name:"intersect",rawName:"v-intersect",value:e.shown,expression:"shown"}],staticClass:"song-list",attrs:{dense:""}},e._l(e.songs,(function(t,i){return s("song-item",{key:t.name+t.video_id+i,class:{active:i===e.currentId},attrs:{song:t,"always-show-deletion":"","hover-icon":e.icons.mdiPlay},on:{play:function(t){return e.$store.commit("music/skipTo",i)},remove:function(t){return e.$store.commit("music/removeSong",i)}}})})),1)},Z=[];K._withStripped=!0;const J={};var Q=c(G,K,Z,!1,X,null,null,null);function X(e){for(let t in J)this[t]=J[t]}Q.options.__file="src/components/media/SongPlaylist.vue";const ee=function(){return Q.exports}(),te={[u.NATURAL]:y,[u.LOOP]:b,[u.LOOPONE]:f,[u.SHUFFLE]:_},se={name:"MusicBar2",components:{SongFrame:W,SongPlaylist:ee,ResponsiveMenu:m},data:()=>({value:"/",mdiSkipNext:k,mdiVolumeHigh:P,mdiShuffleVariant:_,mdiRepeat:b,mdiRepeatOff:y,mdiRepeatOnce:f,mdiMicrophoneVariant:w,mdiSkipPrevious:S,mdiPlaylistRemove:x,songlength:0,progress:0,player:null,songProgressTimestamp:0,songStartTimestamp:0,patience:0,showPatience:!1,queueMenuOpen:!1,titleTransition:"scroll-y-reverse-transition",allowPlayOverride:0,isEmbedPlayerInBackground:!1,isHidePlayer:!1,pinNav:!1,showNavbar:!0,isActiveBar:!0,lastScrollPosition:0,timeCounter:10,counterEnable:!0}),computed:(ie=r(r(r({isMobile(){return this.$store.state.isMobile},playButtonIcon(){return this.state===d.PLAYING?E:$},shuffleButtonIcon(){return te[this.mode]},animateAdded:{get(){return this.addedAnimation},set(){this.$store.commit("music/stopAddedAnimation")}}},C("settings",["nameProperty"])),C("music",["currentId","playId","playlist","state","mode","addedAnimation","isOpen","lastNextSong"])),T("music",["currentSong","canPlay"])),ne={song(){return this.currentSong&&this.currentSong.song}},t(ie,s(ne))),watch:{isOpen(){setTimeout((()=>{this.$refs.sheet&&(this.$refs.sheet.showScroll(),this.$nextTick((()=>this.$refs.sheet.unbind())))}),100)},isActiveBar(e){e&&setTimeout((()=>{this.$refs.sheet&&(this.$refs.sheet.showScroll(),this.$nextTick((()=>this.$refs.sheet.unbind())))}),100)},playlist(e){0===e.length&&this.$store.commit("music/closeBar"),!1===this.isOpen&&0===e.length&&this.$store.commit("music/openBar")},currentSong:{deep:!0,handler(e,t){var s,i;if(null!=t&&this.progress>80&&this.progress<105){const{song:e}=t;e.id?g.trackSong(e.id,null==(s=this.$store.state.userdata)?void 0:s.jwt).catch((e=>console.error(e))):g.trackSongPlay(e.channel_id,e.video_id,e.name,null==(i=this.$store.state.userdata)?void 0:i.jwt).catch((e=>console.error(e))),this.$gtag.event("fully-listen",{event_category:"music",event_label:e.channel.name})}}},titleTransition(e){"scroll-y-reverse-transition"!==e&&setTimeout((()=>{this.titleTransition="scroll-y-reverse-transition"}),500)},timeCounter(){this.timeCounter>0&&this.counterEnable&&!this.pinNav&&setTimeout((()=>{this.timeCounter>0&&this.counterEnable&&(this.timeCounter-=1),this.timeCounter<=0&&(this.showNavbar=!1)}),1e3)},counterEnable(e){this.pinNav||e&&this.timeCounter>0&&setTimeout((()=>{this.timeCounter-=1}),1e3)},showNavbar(e){this.pinNav||(e?(this.$refs.sheet.isActive=!0,this.isActiveBar=!0):(this.$refs.sheet.isActive=!1,this.isActiveBar=!1))}},mounted(){window.addEventListener("blur",this.probableMouseClickInIFrame),window.addEventListener("scroll",this.onScroll),document.getElementsByClassName("mouseEnterTrigger")[0].addEventListener("mouseenter",this.mouseOver),document.getElementsByClassName("mouseEnterTrigger")[0].addEventListener("mouseleave",this.mouseOut),document.getElementsByClassName("mouseEnterTrigger")[1].addEventListener("mouseenter",this.mouseOver),document.getElementsByClassName("mouseEnterTrigger")[1].addEventListener("mouseleave",this.mouseOut),this.timeCounter=5},beforeDestroy(){window.removeEventListener("blur",this.probableMouseClickInIFrame),window.removeEventListener("scroll",this.onScroll),document.getElementsByClassName("mouseEnterTrigger")[0].removeEventListener("mouseenter",this.mouseOver),document.getElementsByClassName("mouseEnterTrigger")[0].removeEventListener("mouseleave",this.mouseOut),document.getElementsByClassName("mouseEnterTrigger")[1].addEventListener("mouseenter",this.mouseOver),document.getElementsByClassName("mouseEnterTrigger")[1].addEventListener("mouseleave",this.mouseOut)},methods:{resizeArtwork:h,songIsDone(){console.log(`Received notice that song ${this.song.name} is done. Asking for next song.`),this.$store.commit("music/nextSong",{isAuto:!0})},songIsPlaying(e){console.log("PLAYING"),this.player=e,this.showPatience=!1,this.patience=0;const{start:t,end:s}=this.song;this.songlength=s-t,this.songStartTimestamp=t,!this.isOpen||this.state===d.PAUSED&&0===this.allowPlayOverride?this.player.pauseVideo():(this.$store.commit("music/play"),this.$gtag.event("play",{event_category:"music",event_label:this.song.channel.name}))},songIsPaused(){console.log("PAUSED"),this.$store.commit("music/pause"),this.$gtag.event("pause",{event_category:"music",event_label:this.song.channel.name})},songBuffering(){},mathFloorTime(){return Math.floor(this.songProgressTimestamp-this.songStartTimestamp)},timeFormat:e=>p(1e3*e),mouseOver(){this.pinNav||(this.timeCounter=5,this.showNavbar=!0,this.counterEnable=!1)},mouseOut(){this.pinNav||(this.counterEnable=!0)},songProgress(e){if(!this.song)return void(this.progress=0);if(this.showPatience)return this.patience-=33,console.log("Patience:",this.patience),void((this.patience<=0||"hidden"===document.visibilityState)&&-1===this.player.getPlayerState()&&(console.log("Patience is now 0, requesting next song forcibly."),this.$store.commit("music/nextSong",{isAuto:!0,breakLoop:!0}),this.$store.commit("music/play"),this.patience=70));this.songProgressTimestamp=e;const{start:t,end:s}=this.song;this.progress=100*Math.min(Math.max(0,(e-t)/(s-t)),1),e>s&&1===this.player.getPlayerState()?(console.log(`Progress debug: time=${e}, end=${s}`),Date.now()-this.lastNextSong>8e3&&(console.log("Next song triggered by temporal progress tick"),this.$store.commit("music/nextSong",{isAuto:!0}))):e<t-10&&this.player.seekTo(t)},songError(){if(console.log("Youtube Player encountered error"),this.showPatience=!0,this.patience=120,"hidden"===document.visibilityState)return console.log("Since the window is hidden. Trigger next song"),this.$store.commit("music/nextSong",{isAuto:!0,breakLoop:!0}),void this.$store.commit("music/play");console.log("Due to error, Window is visible, so we are entering patience countdown.")},songReady(e){console.log("Youtube Player is Ready"),e&&(this.player=e);const t=this;setTimeout((()=>{const s=-1===e.getPlayerState(),i=e.getVideoData();if(s&&(!i||""===i.title)){if(console.log("YT player has been ready for 2s without having loaded the video data. We think it's a privated video or a unplayable video."),t.showPatience=!0,t.patience=120,"hidden"===document.visibilityState)return console.log("Window isn't in view, requesting continue to next song"),this.$store.commit("music/nextSong",{isAuto:!0,breakLoop:!0}),void this.$store.commit("music/play");console.log("Window is visible, entering patience countdown.")}}),2e3)},playPause(){this.player&&(this.state===d.PLAYING?(this.$store.commit("music/pause"),this.player.pauseVideo()):(this.$store.commit("music/play"),this.player.playVideo()))},closePlayer(){this.$store.commit("music/closeBar"),this.player&&this.player.pauseVideo(),this.$store.commit("music/pause"),this.$gtag.event("close",{event_category:"music",event_label:this.song.channel.name})},progressChange(e){this.song&&this.player&&(this.progress=e/this.songStartTimestamp*100,this.player.seekTo(Math.floor(e+this.songStartTimestamp)))},prevButtonHandler(){this.progress>5?this.player.seekTo(this.song.start):(this.titleTransition="scroll-y-transition",this.$store.commit("music/prevSong"))},nextButtonHandler(){this.progress<80&&this.$gtag.event("quick-skip",{event_category:"music",event_label:this.song.channel.name}),this.titleTransition="scroll-y-reverse-transition",this.$store.commit("music/nextSong",{breakLoop:!0}),this.progress=0},probableMouseClickInIFrame(){this.allowPlayOverride=Date.now()},toggleSongFrameModality(){this.isEmbedPlayerInBackground?(this.isHidePlayer&&(this.isEmbedPlayerInBackground=!this.isEmbedPlayerInBackground),this.isHidePlayer=!this.isHidePlayer):this.isEmbedPlayerInBackground=!this.isEmbedPlayerInBackground},togglePinNav(){this.pinNav=!this.pinNav},onScroll(){if(!this.pinNav){const e=window.pageYOffset||document.documentElement.scrollTop;if(e<0)return;Math.abs(e-this.lastScrollPosition)>15&&(this.showNavbar=e>this.lastScrollPosition,this.showNavbar&&(this.timeCounter=5,this.counterEnable=!0)),this.lastScrollPosition=e}}}};var ie,ne,oe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.song?s(O,{attrs:{"hide-overlay":"",persistent:"","no-click-animation":"",value:e.isOpen,"retain-focus":!1,"content-class":"music-player-bar"}},[s("div",{staticClass:"mouseEnterTrigger"},[s("portal-target",{attrs:{name:"slide-bar-top"}})],1)]):e._e(),e.song?s(O,{ref:"sheet",attrs:{id:"thisSheet","hide-overlay":!0,persistent:"","no-click-animation":"",value:e.isOpen,"retain-focus":!1,transition:"slide","content-class":"music-player-bar"}},[s("div",{staticClass:"mouseEnterTrigger"},[s("portal",{attrs:{to:"slide-bar-top"}},[s(I,{staticClass:"music-progress",attrs:{"hide-details":"",value:e.mathFloorTime(),min:"0",max:e.songlength,"thumb-label":!0,height:"15"},on:{change:e.progressChange},scopedSlots:e._u([{key:"thumb-label",fn:function(t){var s=t.value;return[e._v(" "+e._s(e.timeFormat(s))+" ")]}}],null,!1,3329798336)})],1),s("portal-target",{attrs:{name:"slide-bar-top"}}),s("div",{staticClass:"d-flex justify-space-between pa-2",class:{"flex-column":e.$vuetify.breakpoint.xs}},[s("div",{staticClass:"player-controls d-flex align-center"},[s("div",[s(N,{staticClass:"mx-1",attrs:{icon:"",color:"secondary"},on:{click:e.prevButtonHandler}},[s(B,[e._v(e._s(e.mdiSkipPrevious))])],1),s(N,{attrs:{icon:"",fab:"",color:"primary"},on:{click:e.playPause}},[s(B,{attrs:{"x-large":""}},[e._v(" "+e._s(e.playButtonIcon)+" ")])],1),s(N,{staticClass:"mx-1",attrs:{icon:"",color:"secondary"},on:{click:e.nextButtonHandler}},[s(M,{class:{invisible:!e.showPatience},attrs:{color:"warning",value:e.patience,size:"40"}},[s(B,{attrs:{color:"secondary"}},[e._v(" "+e._s(e.mdiSkipNext)+" ")])],1)],1),s(N,{staticClass:"mx-1",attrs:{icon:"",color:"secondary"},on:{click:function(t){return e.$store.commit("music/cycleMode")}}},[s(B,[e._v(e._s(e.shuffleButtonIcon))])],1),s("ResponsiveMenu",{attrs:{"close-on-content-click":!1,"offset-y":"",top:"",origin:"right bottom",transition:"slide-y-reverse-transition","min-width":"30vw","max-width":"50vw","max-height":"50vh","item-count":e.playlist.length},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[s(N,e._g({staticClass:"queue-btn mx-1 px-1",class:{"added-animation":e.animateAdded},attrs:{elevation:"0",ripple:!1},on:{animationend:function(t){e.animateAdded=!1},click:function(t){e.queueMenuOpen=!e.queueMenuOpen}}},i),[s(B,{attrs:{color:"secondary"}},[e._v(" "+e._s(e.icons.mdiPlaylistMusic)+" ")]),s("div",{staticClass:"secondary--text text--darken-2"},[e._v(" ("+e._s(e.currentId+1)+"/"+e._s(e.playlist.length)+") ")])],1)]}}],null,!1,3779055440),model:{value:e.queueMenuOpen,callback:function(t){e.queueMenuOpen=t},expression:"queueMenuOpen"}},[s("song-playlist",{attrs:{songs:e.playlist,"current-id":e.currentId}})],1),s(A,[e.queueMenuOpen?s(N,{staticStyle:{position:"relative","margin-right":"-60px"},attrs:{small:"",elevation:"0",color:"warning"},on:{click:function(){e.queueMenuOpen=!1,e.$store.commit("music/clearPlaylist")}}},[s(B,{attrs:{left:""}},[e._v(" "+e._s(e.mdiPlaylistRemove)+" ")]),e._v(" "+e._s(e.$t("component.music.clearPlaylist"))+" ")],1):e._e()],1)],1),e.$vuetify.breakpoint.xs?s("div",{staticStyle:{display:"flex","flex-direction":"column","align-items":"center"}},[s(N,{attrs:{icon:""},on:{click:e.closePlayer}},[s(B,[e._v(e._s(e.icons.mdiClose))])],1),s(N,{attrs:{icon:"",large:""},on:{click:e.toggleSongFrameModality}},[s(B,[e._v(e._s(e.icons.mdiTheater))])],1),s(N,{attrs:{icon:"",large:""},on:{click:e.togglePinNav}},[s(B,[e._v(e._s(e.icons.mdiPinOutline))])],1)],1):e._e()]),s("transition",{attrs:{name:e.titleTransition,mode:"out-in"}},[s("div",{key:"snip"+(e.song&&e.song.name),staticClass:"d-flex align-center"},[s("div",{staticClass:"pr-2"},[e.song&&e.song.art?s(L,{attrs:{src:e.resizeArtwork(e.song.art,50),"aspect-ratio":"1",height:"auto",width:"50px"}}):e._e()],1),s("div",[s("div",{staticClass:"text-h6"},[e._v(" "+e._s(e.song.name)+" ")]),s("div",{staticClass:"single-line-clamp"},[s("router-link",{staticClass:"text-subtitle-2 secondary--text mr-2",attrs:{id:"songChannel",to:"/channel/"+e.song.channel_id}},[e._v(" "+e._s(e.song.channel[e.nameProperty]||e.song.channel.name)+" ")]),s("span",{staticClass:"text-subtitle-2 grey--text"},[e._v("("+e._s(e.song.original_artist)+")")])],1)]),s("div",{staticClass:"music-more-btn"},[s(j,{attrs:{bottom:"","nudge-top":"20px"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[s(N,e._g({staticClass:"mt-1",attrs:{icon:"",large:""},on:{click:function(e){e.stopPropagation(),e.preventDefault()}}},i),[s(B,[e._v(" "+e._s(e.icons.mdiDotsVertical)+" ")])],1)]}}],null,!1,3816391090)},[s(v,{attrs:{dense:""}},[s(q,{attrs:{target:"_blank",href:"https://youtu.be/"+e.song.video_id+"?t="+e.song.start},on:{click:function(e){e.stopPropagation()}}},[s(B,{attrs:{left:""}},[e._v(" "+e._s(e.icons.mdiYoutube)+" ")]),e._v(" "+e._s(e.$t("views.settings.redirectModeLabel"))+" ")],1),s(q,{attrs:{to:"/edit/video/"+e.song.video_id+"/music"}},[s(B,{attrs:{left:""}},[e._v(" "+e._s(e.icons.mdiPencil)+" ")]),e._v(" "+e._s(e.$t("component.videoCard.edit"))+" ")],1)],1)],1)],1)])]),e.$vuetify.breakpoint.smAndUp?s("div",{staticClass:"playlist-buttons align-self-center"},[s(N,{attrs:{icon:"",large:"",color:e.pinNav?"secondary lighten-2":""},on:{click:e.togglePinNav}},[s(B,[e._v(e._s(e.icons.mdiPinOutline))])],1),s(N,{attrs:{icon:"",large:"",color:e.isEmbedPlayerInBackground?e.isHidePlayer?"primary lighten-2":"secondary lighten-2":""},on:{click:e.toggleSongFrameModality}},[s(B,[e._v(e._s(e.icons.mdiTheater))])],1),s(N,{attrs:{icon:"",large:""},on:{click:e.closePlayer}},[s(B,[e._v(e._s(e.icons.mdiClose))])],1)],1):e._e()],1)],1),s("portal",{attrs:{to:"music-playback-background"}},[s("song-frame",{directives:[{name:"show",rawName:"v-show",value:!e.isHidePlayer,expression:"!isHidePlayer"}],attrs:{playback:e.currentSong,"is-background":e.isEmbedPlayerInBackground},on:{playing:e.songIsPlaying,paused:e.songIsPaused,ended:e.songIsDone,progress:e.songProgress,error:e.songError,buffering:e.songBuffering,ready:e.songReady}})],1)],1):e._e()],1)},ae=[];oe._withStripped=!0;const re={};var le=c(se,oe,ae,!1,ce,null,null,null);function ce(e){for(let t in re)this[t]=re[t]}le.options.__file="src/components/nav/MusicBar2.vue";const ue=function(){return le.exports}();export{ue as default};