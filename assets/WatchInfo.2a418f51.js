import{C as e}from"./ChannelChip.353d86d7.js";import{a as t,C as s,c as i,l as a,d as n,i as o,n as r}from"./main.e72b2d96.js";import{T as l}from"./TruncatedText.a2f23d8e.js";import{bY as h,a3 as c,al as d,ay as u,bV as m,aB as v,aZ as p,av as f,am as C,aG as g,bm as _,an as w,az as b}from"./vendor.70269bfe.js";const $=/(?:([0-5]?[0-9]):)?([0-5]?[0-9]):([0-5][0-9])/gm,T={name:"WatchInfo",components:{ChannelChip:e,ChannelInfo:t,ChannelSocials:s,ChannelImg:i,TruncatedText:l},props:{video:{type:Object,required:!0,default:null},noChips:{type:Boolean,default:!1},noSubCount:{type:Boolean,default:!1}},data:()=>({timer:null,elapsedTime:0,editMode:!1,showAllMentions:!1,lastViewerCount:-1,mdiAt:h}),computed:{lang(){return this.$store.state.settings.lang},formattedTime(){switch(this.video.status){case"upcoming":return this.formatDistance(this.video.start_scheduled,this.lang,this.$t.bind(this));case"live":return this.$t("component.watch.streamingFor",[this.elapsedTime]);default:return a(this.video.available_at,this.lang).format("LLL")}},liveViewers(){return this.video.live_viewers?(+this.video.live_viewers).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):""},liveViewerChange(){return this.lastViewerCount<0?0:this.video.live_viewers-this.lastViewerCount},mentions(){return this.video.mentions||[]},channelChips(){return this.mentions.length>3&&!this.showAllMentions?this.mentions.slice(0,3):this.mentions},processedMessage(){const e=document.createElement("div");e.innerHTML=this.video.description;const t=e.textContent,s=(this.$store.state.settings.redirectMode?"https://youtu.be/":"/watch/")+this.video.id;return t.replace($,((e,t,i,a)=>{const n=3600*Number(null!=t?t:0)+60*Number(i)+Number(a);return`<a class="comment-chip" href="${s}?t=${n}" data-time="${n}"> ${e} </a>`}))}},watch:{"video.status":function(){this.setTimer()},"video.live_viewers":function(e,t){this.lastViewerCount=t}},mounted(){this.setTimer()},beforeDestroy(){clearInterval(this.timer)},methods:{formatDuration:n,formatDistance:o,setTimer(){this.timer&&clearInterval(this.timer),"live"===this.video.status&&(this.timer=setInterval((()=>{this.elapsedTime=this.formatDuration(c().diff(c(this.video.start_actual)))}),1e3))},handleClick(e){e.target.matches(".comment-chip")&&(this.$emit("timeJump",e.target.getAttribute("data-time")),e.preventDefault())},goToSearchPage(){const e=this.video.topic_id,t=e[0].toUpperCase()+e.slice(1),{org:s}=this.video.channel;let i=`/search?q=type,value,text%0Atopic,${e},${t}`;s&&(i+=`%0Aorg,${s},${s}`),this.$router.push({path:i})}}};var y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(d,{staticClass:"watch-card rounded-0"},[s(u,{staticClass:"pt-2",staticStyle:{"font-size":"1.125rem","font-weight":"400"}},[e.$route.path.includes("edit")?s("router-link",{staticStyle:{cursor:"pointer"},attrs:{tag:"span",to:"/watch/"+e.video.id}},[e._v(" "+e._s(e.video.title)+" ")]):s("span",[e._v(" "+e._s(e.video.title)+" ")])],1),s(m,[e._v(" "+e._s(e.formattedTime)+" "),"live"===e.video.status?[e._v(" â€¢ "+e._s(e.$t("component.videoCard.watching",[e.liveViewers]))+" "),e.liveViewerChange?s("span",{class:e.liveViewerChange>0?"green--text":"red--text"},[e._v(" ("+e._s((e.liveViewerChange>0?"+ ":"")+e.liveViewerChange)+") ")]):e._e()]:e._e()],2),s(v),s("div",{staticClass:"d-flex justify-space-between flex-wrap align-center"},[s(p,{attrs:{cols:"auto"}},[s(f,[s(C,[s(g,{attrs:{size:"80"}},[s("ChannelImg",{attrs:{channel:e.video.channel,size:"80"}})],1),s("ChannelInfo",{staticClass:"uploader-data-list",attrs:{channel:e.video.channel,"no-subscriber-count":e.noSubCount}}),s("ChannelSocials",{attrs:{channel:e.video.channel}})],1)],1)],1),s(p,{attrs:{cols:"auto"}},[e.channelChips&&e.channelChips.length>0?s(_,{attrs:{rounded:"",left:"",size:"40"}},[s(w,{attrs:{size:"25",color:"grey darken-2"}},[e._v(" "+e._s(e.mdiAt)+" ")])],1):e._e(),e._l(e.channelChips,(function(e){return[s("ChannelChip",{key:e.id,attrs:{channel:e,size:60}})]})),e.mentions.length>3?s("a",{staticClass:"text-subtitle-2",staticStyle:{"white-space":"pre"},on:{click:function(t){e.showAllMentions=!e.showAllMentions}}},[e._v(" [ "+e._s(e.showAllMentions?"-":"+")+" "+e._s(e.mentions.length-3)+" ] ")]):e._e()],2)],1),e._t("default",(function(){return[s(b,{staticClass:"text-body-2",on:{click:e.handleClick}},[s("truncated-text",{attrs:{html:e.processedMessage,lines:"4"}})],1)]}))],2)},x=[];y._withStripped=!0;const V={};var A=r(T,y,x,!1,M,null,null,null);function M(e){for(let t in V)this[t]=V[t]}A.options.__file="src/components/watch/WatchInfo.vue";const S=function(){return A.exports}();export{S as W};